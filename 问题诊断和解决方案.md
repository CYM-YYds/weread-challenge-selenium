# WeRead Challenge 问题诊断和解决方案

## 问题1：任务计划程序没有自动执行

### 问题原因
您的笔记本电脑每天并不会主动关机，而之前设置的任务计划程序使用的是"计算机启动时"触发器，只有在电脑重启或开机时才会执行。如果电脑一直处于睡眠、休眠或正常运行状态，任务不会被触发。

### 解决方案
使用每日定时执行的任务计划程序，而不是开机时执行。

#### 方法一：自动设置（推荐）
1. 右键点击 `setup-daily-task.ps1` → **"以管理员身份运行"**
2. 选择每日执行时间（推荐上午9点）
3. 确认创建任务

#### 方法二：手动设置
1. 打开任务计划程序 (`Win + R` → `taskschd.msc`)
2. 找到现有的"WeRead Challenge 自动执行"任务
3. 右键点击 → "属性"
4. 在"触发器"选项卡中：
   - 删除现有的"启动时"触发器
   - 添加新触发器：选择"每日"
   - 设置执行时间（如：上午9:00）
   - ✅ 勾选"唤醒计算机运行此任务"

### 新任务的优势
- ✅ **每日定时执行**：不依赖电脑重启
- ✅ **唤醒功能**：可以从睡眠状态唤醒电脑
- ✅ **防重复执行**：每天只执行一次
- ✅ **自动重试**：失败后自动重试机制

---

## 问题2：一直没有收到邮件

### 可能原因
1. **SMTP配置错误**
2. **邮箱安全设置问题**
3. **网络连接问题**
4. **邮件被拦截或进入垃圾邮件**

### 诊断步骤

#### 第一步：运行邮件测试
1. 右键点击 `test-email.ps1` → "使用PowerShell运行"
2. 查看测试结果：
   - 如果显示"✅ 测试邮件发送成功"，检查邮箱
   - 如果显示错误，继续下面的排查步骤

#### 第二步：检查邮箱设置
您使用的是华中科技大学邮箱 (322422@whut.edu.cn)，需要确认：

1. **邮箱密码是否正确**
   - 确认密码：`Vm3Zgz6AtGJj9JFE`
   - 如果是应用专用密码，确保格式正确

2. **SMTP服务是否启用**
   - 登录华中科技大学邮箱系统
   - 查找"设置" → "POP3/IMAP/SMTP设置"
   - 确保SMTP服务已启用

3. **安全设置**
   - 可能需要启用"不太安全的应用访问"
   - 或者生成应用专用密码

#### 第三步：检查网络连接
```powershell
# 测试SMTP服务器连接
Test-NetConnection -ComputerName smtp.whut.edu.cn -Port 587
```

#### 第四步：检查邮件拦截
1. **检查垃圾邮件文件夹**
2. **检查邮件过滤规则**
3. **添加发件人到白名单**

### 常见SMTP配置问题

#### 华中科技大学邮箱SMTP设置
```
SMTP服务器: smtp.whut.edu.cn
SMTP端口: 587 (TLS) 或 465 (SSL)
加密方式: TLS/SSL
用户名: 322422@whut.edu.cn
密码: [您的邮箱密码或应用专用密码]
```

#### 可能需要的修改
如果587端口不工作，尝试465端口：
```powershell
$env:EMAIL_PORT = "465"
```

### 邮件功能测试脚本说明

`test-email.ps1` 脚本会：
1. ✅ 验证Node.js和nodemailer
2. ✅ 测试SMTP连接
3. ✅ 发送测试邮件
4. ✅ 显示详细的调试信息

---

## 完整解决方案

### 步骤1：修复任务计划程序
```powershell
# 以管理员身份运行
.\setup-daily-task.ps1
```

### 步骤2：测试邮件功能
```powershell
# 测试邮件配置
.\test-email.ps1
```

### 步骤3：验证设置
1. **检查任务计划程序**
   - 打开任务计划程序
   - 找到"WeRead Challenge 每日自动执行"
   - 确认下次运行时间

2. **检查邮件接收**
   - 查看收件箱和垃圾邮件
   - 确认收到测试邮件

### 步骤4：监控执行
查看日志文件：
- `data\auto-run.log` - 自动执行日志
- `data\output.log` - 程序执行日志

---

## 故障排除命令

### 查看任务状态
```powershell
Get-ScheduledTask -TaskName "*WeRead*"
```

### 手动运行任务
```powershell
Start-ScheduledTask -TaskName "WeRead Challenge 每日自动执行"
```

### 查看任务历史
```powershell
Get-WinEvent -FilterHashtable @{LogName="Microsoft-Windows-TaskScheduler/Operational"} | Where-Object {$_.Message -like "*WeRead*"} | Select-Object -First 10
```

### 测试网络连接
```powershell
Test-NetConnection -ComputerName smtp.whut.edu.cn -Port 587
Test-NetConnection -ComputerName smtp.whut.edu.cn -Port 465
```

---

## 预期结果

设置完成后，您应该：
1. ✅ 每天定时自动执行WeRead Challenge
2. ✅ 收到程序开始和结束的邮件通知
3. ✅ 在日志文件中看到执行记录
4. ✅ 即使电脑睡眠也能正常唤醒执行

---

## 联系支持

如果问题仍然存在，请提供：
1. `test-email.ps1` 的执行结果
2. `data\auto-run.log` 的内容
3. 任务计划程序中的任务状态截图

这样可以更准确地诊断问题。
