# Windows任务计划程序设置指南

## 概述
本指南将帮助您设置Windows任务计划程序，实现每天开机后自动执行一次WeRead Challenge脚本。

## 前提条件
- ✅ 已安装Node.js
- ✅ WeRead Challenge项目文件完整
- ✅ PowerShell脚本可以正常运行
- ✅ 已创建 `run-auto.ps1` 脚本

## 设置步骤

### 第一步：打开任务计划程序
1. 按 `Win + R` 打开运行对话框
2. 输入 `taskschd.msc` 并按回车
3. 或者在开始菜单搜索"任务计划程序"

### 第二步：创建基本任务
1. 在右侧操作面板中，点击 **"创建基本任务..."**
2. 输入任务名称：`WeRead Challenge 自动执行`
3. 输入描述：`每天开机后自动执行一次WeRead Challenge阅读任务`
4. 点击 **"下一步"**

### 第三步：设置触发器
1. 选择 **"计算机启动时"**
2. 点击 **"下一步"**

### 第四步：设置操作
1. 选择 **"启动程序"**
2. 点击 **"下一步"**
3. 在"程序或脚本"中输入：
   ```
   powershell.exe
   ```
4. 在"添加参数"中输入：
   ```
   -ExecutionPolicy Bypass -File "完整路径\run-auto.ps1"
   ```
   **注意**：将"完整路径"替换为您的项目实际路径，例如：
   ```
   -ExecutionPolicy Bypass -File "D:\Projects\weread-challenge-selenium\run-auto.ps1"
   ```
5. 在"起始于"中输入项目目录路径，例如：
   ```
   D:\Projects\weread-challenge-selenium
   ```
6. 点击 **"下一步"**

### 第五步：完成创建
1. 勾选 **"当单击'完成'时，打开此任务属性的对话框"**
2. 点击 **"完成"**

### 第六步：高级设置
任务属性对话框会自动打开，进行以下设置：

#### 常规选项卡
- ✅ 勾选 **"不管用户是否登录都要运行"**
- ✅ 勾选 **"使用最高权限运行"**
- 在"配置"下拉菜单中选择 **"Windows 10"**

#### 触发器选项卡
1. 双击现有触发器进行编辑
2. ✅ 勾选 **"延迟任务时间"**，设置为 **5分钟**
3. 在"高级设置"中：
   - ✅ 勾选 **"已启用"**
4. 点击 **"确定"**

#### 操作选项卡
确认操作设置正确（之前已设置）

#### 条件选项卡
- ✅ 勾选 **"只有在计算机使用交流电源时才启动此任务"**（笔记本电脑建议）
- ✅ 勾选 **"只有在以下网络连接可用时才启动此任务"** → 选择 **"任何连接"**

#### 设置选项卡
- ✅ 勾选 **"允许按需运行任务"**
- ✅ 勾选 **"如果请求后任务还在运行，强行将其停止"**
- ✅ 勾选 **"如果任务失败，按以下间隔重新启动"** → 设置为 **1小时**，最多重试 **3次**

### 第七步：保存并测试
1. 点击 **"确定"** 保存任务
2. 如果提示输入密码，输入当前用户的Windows密码
3. 在任务计划程序库中找到刚创建的任务
4. 右键点击任务，选择 **"运行"** 进行测试

## 验证设置

### 检查任务状态
1. 在任务计划程序中查看任务状态
2. 查看"上次运行时间"和"上次运行结果"
3. 状态应显示为"就绪"

### 检查日志文件
任务执行后，检查以下文件：
- `data\auto-run.log` - 自动执行日志
- `data\last-run.txt` - 上次执行日期
- `data\output.log` - WeRead程序日志

### 手动测试
重启电脑，观察是否在开机5分钟后自动执行任务。

## 故障排除

### 常见问题

**1. 任务不执行**
- 检查触发器设置是否正确
- 确认PowerShell执行策略
- 检查文件路径是否正确

**2. 权限问题**
- 确保勾选了"使用最高权限运行"
- 检查用户账户权限

**3. 脚本执行失败**
- 查看 `data\auto-run.log` 日志文件
- 手动运行 `run-auto.ps1` 测试
- 检查Node.js和依赖是否正常

**4. 重复执行**
- 脚本内置了防重复执行机制
- 检查 `data\last-run.txt` 文件

### 调试命令
在PowerShell中运行以下命令进行调试：
```powershell
# 查看任务状态
Get-ScheduledTask -TaskName "WeRead Challenge 自动执行"

# 手动运行任务
Start-ScheduledTask -TaskName "WeRead Challenge 自动执行"

# 查看任务历史
Get-WinEvent -FilterHashtable @{LogName="Microsoft-Windows-TaskScheduler/Operational"}
```

## 注意事项

1. **网络连接**：脚本会等待网络连接，最多等待5分钟
2. **系统启动**：开机后延迟5分钟执行，确保系统完全启动
3. **一天一次**：脚本内置防重复执行机制
4. **日志记录**：所有执行情况都会记录在日志文件中
5. **邮件通知**：执行开始和结束时会发送邮件通知

## 卸载任务

如需删除自动任务：
1. 打开任务计划程序
2. 找到"WeRead Challenge 自动执行"任务
3. 右键点击，选择"删除"
4. 确认删除

## 修改设置

如需修改执行时间或其他设置：
1. 在任务计划程序中双击任务
2. 修改相应的选项卡设置
3. 点击"确定"保存

---

**提示**：首次设置建议先手动测试任务执行，确认无误后再依赖自动执行。
